{% extends '_layouts/admin/main.html.twig' %}

{% block page %}Quản Lý Danh Mục{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-xl-12">
            <div>
                <div class="col-xl-3 mb-3">
                    <a href="{{ path('admin_category_create') }}"
                       class="btn btn-lg btn-primary btn-block waves-effect waves-light ">
                        <i class="fa fa-plus mr-1"></i> Thêm Danh Mục
                    </a>
                </div>
                <table id="category-datatable-buttons"
                       class="table table-striped table-bordered dt-responsive nowrap"
                       style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                    <thead>
                    <tr>
                        <th>Mã Danh mục</th>
                        <th>Tên danh mục</th>
                        <th>Thư Mục Cha</th>
                        <th>Trạng Thái</th>
                        <th>Ảnh</th>
                        <th>Mô tả</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                    <tr>
                        <th>Mã Danh mục</th>
                        <th>Tên danh mục</th>
                        <th>Thư Mục Cha</th>
                        <th>Trạng Thái</th>
                        <th>Ảnh</th>
                        <th>Mô tả</th>
                        <th></th>
                    </tr>
                    </tfoot>
                </table>

            </div>
        </div>
        <!-- end col -->
    </div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="module">
        $(document).ready(function () {
            $("#category-datatable-buttons").DataTable({
                lengthChange: false,
                buttons: ["copy", "excel", "pdf"],
                order: [[0, 'desc']],
                ajax: '{{ url('admin_category_list') }}',
                columns: [
                    {data: 'slug'},
                    {data: 'name'},
                    {
                        data: 'parent',
                        render: function (data) {
                            if (data === '-') {
                                return 'Không có';
                            }
                            return data;
                        }
                    },
                    {
                        data: 'status', render: function (data) {
                            if (data === 1) {
                                return 'Kích Hoạt';
                            } else if (data === 0) return 'Không Kích Hoạt';
                            else return 'Draft';
                        }
                    },
                    {
                        data: 'image', render: function (data) {
                            if (data === null) {
                                return 'Không có';
                            } else return data;
                        }
                    },
                    {
                        data: 'description', render: function (data) {
                            if (data === null) {
                                return 'Không có';
                            } else return data;
                        }
                    },
                    {
                        data: 'actions', render: function (data) {
                            return '' +
                                '<a href="'+ data.detail +'" style="padding-right: 7px"><i class="fa fa-info-circle"></i></a>' +
                                '<a href="'+ data.update +'" style="padding-right: 7px"><i class="fa fa-edit"></i></a>' +
                                '<a href="#" class="btn-delete" data-url="'+ data.delete +'"><i class="fa fa-trash" ></i></a>';
                        }
                    }
                ],
                columnDefs: [
                    {orderable: false, targets: 3},
                    {searchable: false, targets: 3},
                    { width:  '5%', targets: 0 },
                    { width: '15%', targets: 1 },
                    { width: '15%', targets: 2 },
                    { width: '14%', targets: 3 },
                    { width: '14%', targets: 4 },
                    { width: '14%', targets: 5 },
                    { width: '5%', targets: 6 },
                ],
                initComplete: function () {
                    this.api()
                        .columns()
                        .every(function () {
                            let column = this;

                            if (column.index() === 6) {
                                return;
                            }

                            let input = document.createElement('input');
                            input.type = 'text';
                            input.style.width = '100%';
                            input.placeholder = 'Search...';
                            column.footer().replaceChildren(input);

                            input.addEventListener('input', function () {
                                column
                                    .search(input.value, { exact: false })
                                    .draw();
                            });
                        });
                }
            });
            a.buttons().container().appendTo("#category-datatable-buttons_wrapper .col-md-6:eq(0)");
        });

        $(document).on('click', '.btn-delete', function () {
            let deleteUrl = $(this).data('url');

            if (confirm('Bạn có chắc chắn muốn xóa?')) {
                $.ajax({
                    url: deleteUrl,
                    type: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    success: function () {
                        alert('Xóa thành công!');
                        location.reload();
                    },
                    error: function () {
                        alert('Có lỗi xảy ra khi xóa!');
                    }
                });
            }
        });
    </script>

{% endblock %}
